{{ 'component-slider.css' | asset_url | stylesheet_tag }}
<script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
<style>
.cart-upsell {
    margin-top: 20px;
    text-align: center;
}

.upsell-carousel {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    max-width: 300px;
    margin: auto;
}

.upsell-track {
    overflow: hidden;
    width: 200px;
}

.upsell-items {
    display: flex;
    gap: 10px;
    transition: transform 0.4s ease-in-out;
}

.upsell-item {
    min-width: 100px;
    text-align: center;
}

.upsell-item img {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 8px;
}

.prev-btn, .next-btn {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
}
</style>

{%- render 'cart-drawer' -%}

<script>
    document.addEventListener('DOMContentLoaded', function () {

    const track = document.querySelector(".upsell-items");
    const prevBtn = document.querySelector(".prev-btn");
    const nextBtn = document.querySelector(".next-btn");
    const itemWidth = 110; // Width of each upsell item + margin
    let currentIndex = 0;

    nextBtn.addEventListener("click", () => {
        const maxScroll = track.scrollWidth - track.clientWidth;
        if (track.scrollLeft < maxScroll) {
            track.scrollLeft += itemWidth;
        }
    });

    prevBtn.addEventListener("click", () => {
        if (track.scrollLeft > 0) {
            track.scrollLeft -= itemWidth;
        }
    });

        document.querySelectorAll('.cart-upsell .form').forEach((form) => {
            form.addEventListener('submit', function (event) {
                event.preventDefault(); // Prevent the default form submission

                let formData = new FormData(form);
                let productId = form.querySelector('.product-variant-id').value;

                fetch('/cart/add.js', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Product added:', data);
                    updateCartDrawer(); // Refresh the cart drawer
                })
                .catch(error => console.error('Error adding to cart:', error));
            });
        });
    });

    function updateCartDrawer() {
        fetch('/cart.js')
        .then(response => response.json())
        .then(cart => {
            let cartDrawer = document.querySelector('cart-drawer'); // Adjust selector as needed
            if (cartDrawer) {
                fetch('/cart')
                    .then(response => response.text())
                    .then(html => {
                        let parser = new DOMParser();
                        let doc = parser.parseFromString(html, 'text/html');
                        let newCartContent = doc.querySelector('cart-drawer').innerHTML;
                        cartDrawer.innerHTML = newCartContent;
                    });
            }
        });
    }
</script>