{%- for link in section.settings.menu.links -%}
  <li>
    {%- if link.links != blank -%}
      <header-menu>
        <details id="Details-HeaderMenu-{{ forloop.index }}" class="mega-menu">
          <summary class="header__menu-item list-menu__item">
            {{ link.title | escape }}
          </summary>
          <div class="mega-menu__content">
            <ul class="mega-menu__list" role="list">
              {%- for childlink in link.links -%}
                <li>
                  <a href="{{ childlink.url }}" class="mega-menu__link">{{ childlink.title | escape }}</a>

                  {%- for block in blocks -%}
                    {%- if block.type == "image" and block.settings.position == forloop.parentloop.index -%}
                      <div class="mega-menu-image">
                        {%- if block.settings.image -%}
                          <img src="{{ block.settings.image | image_url: 'medium' }}" alt="{{ block.settings.title }}">
                        {%- endif -%}
                        {%- if block.settings.title != blank -%}
                          <h3>{{ block.settings.title }}</h3>
                        {%- endif -%}
                        {%- if block.settings.link_text != blank -%}
                          <a href="{{ block.settings.link }}" class="mega-menu-link">{{ block.settings.link_text }}</a>
                        {%- endif -%}
                      </div>
                    {%- endif -%}
                  {%- endfor -%}

                </li>
              {%- endfor -%}
            </ul>
          </div>
        </details>
      </header-menu>
    {%- else -%}
      <a href="{{ link.url }}" class="header__menu-item list-menu__item">{{ link.title | escape }}</a>
    {%- endif -%}
  </li>
{%- endfor -%}
